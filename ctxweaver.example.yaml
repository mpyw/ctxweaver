# ctxweaver configuration example
# Copy this file to ctxweaver.yaml and customize for your project.

# Template for the statement to insert at the beginning of context-aware functions.
#
# TIP: For Go text/template syntax guide, see: https://docs.gomplate.ca/syntax/
#
# Supports Go text/template syntax with the following variables:
#   - {{.Ctx}}               : Expression to access context.Context (e.g., "ctx", "c.Request().Context()")
#   - {{.CtxVar}}            : The variable name of the context carrier (e.g., "ctx", "c")
#   - {{.FuncName}}          : Fully qualified function name (e.g., "pkg.Func", "pkg.(*Type).Method")
#   - {{.FuncBaseName}}      : Function name without package/receiver (e.g., "Func", "Method")
#   - {{.PackageName}}       : Package name (e.g., "pkg")
#   - {{.PackagePath}}       : Full package path (e.g., "github.com/user/repo/pkg")
#   - {{.IsMethod}}          : true if the function is a method
#   - {{.ReceiverType}}      : Receiver type name for methods (e.g., "MyService")
#   - {{.ReceiverVar}}       : Receiver variable name for methods (e.g., "s")
#   - {{.IsPointerReceiver}} : true if the receiver is a pointer
#   - {{.IsGenericFunc}}     : true if the function has type parameters
#   - {{.IsGenericReceiver}} : true if the receiver type has type parameters
#
# Built-in template functions:
#   - quote    : Wraps value in double quotes (e.g., {{.FuncName | quote}} -> "pkg.Func")
#   - backtick : Wraps value in backticks (e.g., {{.FuncName | backtick}} -> `pkg.Func`)
#
# FuncName format examples:
#   - Function:                       "service.CreateUser"
#   - Method (pointer receiver):      "service.(*UserService).GetByID"
#   - Method (value receiver):        "service.UserService.String"
#   - Generic function:               "service.Process[...]"
#   - Generic method (pointer):       "service.(*Container[...]).Get"
#   - Generic method (value):         "service.Wrapper[...].Unwrap"
template: |
  defer newrelic.FromContext({{.Ctx}}).StartSegment({{.FuncName | quote}}).End()

# Alternative: Load template from a file instead of inline.
# If both template and template_file are specified, template takes precedence.
# template_file: ./template.go.tmpl

# Imports to add when the template is inserted.
# These are automatically added via goimports when a function is instrumented.
imports:
  - github.com/newrelic/go-agent/v3/newrelic

# Package patterns to process.
# Uses the same syntax as `go list` (e.g., "./...", "./pkg/...", "github.com/user/repo/...").
# Can be overridden by command-line arguments.
patterns:
  - ./...

# Whether to process test files (*_test.go).
# Can be overridden by --test flag.
test: false

# Custom context carrier definitions.
# ctxweaver comes with built-in support for common carriers:
#   - context.Context
#   - echo.Context (github.com/labstack/echo/v4)
#   - gin.Context (github.com/gin-gonic/gin)
#   - fiber.Ctx (github.com/gofiber/fiber/v2)
#   - cli.Context (github.com/urfave/cli/v2)
#   - *cobra.Command (github.com/spf13/cobra)
#
# Add custom carriers here for your own types that wrap context.Context.
carriers:
  # - package: github.com/example/myframework
  #   type: Context
  #   accessor: .Context()  # How to extract context.Context from this type

# Shell commands to run before and after processing.
# Use --no-hooks flag to skip hooks (useful for CI).
hooks:
  # Commands to run before processing.
  # Commands are executed sequentially. If any command fails (non-zero exit),
  # processing is aborted and no files are modified.
  pre:
    - go mod tidy

  # Commands to run after processing.
  # Commands are executed sequentially. If any command fails (non-zero exit),
  # an error is reported but files have already been modified.
  post:
    - gci write .
    - gofmt -w .
